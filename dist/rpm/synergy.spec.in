Name: synergy
Version: @SYNERGY_VERSION@
Summary: Keyboard and mouse sharing solution
Group: Applications/Productivity
URL: https://symless.com/synergy
Source: https://symless.com/synergy/downloads
Vendor: Symless
Packager: Symless <engineering@symless.com>
License: GPLv2
Release: @SYNERGY_BUILD_NUMBER@@SYNERGY_SNAPSHOT_INFO@%{?dist}
Requires: qt5-qtquickcontrols qt5-qtsvg
BuildRequires: systemd

%description
Synergy allows you to share one mouse and keyboard between multiple computers.
Work seamlessly across Windows, macOS and Linux.

%post
systemctl daemon-reload
systemctl enable synergy.service
systemctl daemon-reload
systemctl start synergy.service

%define _unpackaged_files_terminate_build 0

%files
%defattr(755,root,root,-)
%{_bindir}/synergy-config
%{_bindir}/synergy-core
%{_bindir}/synergy-service
%{_bindir}/synergy-tray
%attr(644,-,-) %{_datarootdir}/applications/synergy.desktop
%attr(644,-,-) %{_datarootdir}/icons/synergy.svg
%attr(644,-,-) %{_unitdir}/synergy.service

%postun
# The value of $1 indicates the type of install we are doing, a value of 1 here indicates an upgrade, 0 removal
# see http://meinit.nl/rpm-spec-prepostpreunpostun-argument-values
if [ $1 -eq 0 ]; then
    for dir in `cat /etc/passwd | cut -d : -f 6`
    do
        if [ -d "$dir/.config/Symless/" ]; then
            rm -rf $dir/.config/Symless/
        fi
        if [ -d "$dir/.synergy/" ]; then
                rm -rf $dir/.synergy/
        fi
    done
fi

%changelog
* Wed May 17 2017 Symless <engineering@symless.com>
- Initial version of the package
